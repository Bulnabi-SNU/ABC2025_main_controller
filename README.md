# ABC2025_main_controller

![ABC2025_main_controller](./assets/20250208.png)

ROS2 nodes for Active Balloon Contol project 2025

To solve the Trash Balloon problem caused by the North Korea, we made the autonomous flight drone system to retrieve the Trash Balloon up in the air.

## Installing with ROS

### Install ZED2 ROS2 Wrapper

Follow instructions in this [repo](https://github.com/stereolabs/zed-ros2-wrapper)

### Install this repo

```
git clone {this repository URL}
cd ~/ABC2025_main_controller
colcon build
```

## Running

Connect ZED2i with cable

### Terminal 1 : ZED Node

```
cd {your ZED repo}
rosfoxy # alias
ros2 launch zed_wrapper zed_camera.launch.py camera_model:=zed2i
```

### Terminal 2 : Path Planning Node

```
cd ~/ABC2025_main_controller
rosfoxy # alias
ros2 run path_generation astar_fixed_start
```

### Terminal 3 : Publish Goal Point

```
cd ~/ABC2025_main_controller/src/path_generation/test/
python3 yolo_publisher.py -1.0 8.0 0.0 # Set Goal Location
```

---

### (Optional) Terminal 4 : Visulization

```
rviz2 -d ~/ABC2025_main_controller/assets/rivz_config.rviz # when using zed pcd2 topic
rviz2 -d ~/ABC2025_main_controller/assets/custom.rviz # when using .pcd file
```

### (Optional) Terminal 2, 5 : Use .pcd file instead of Using ZED PCD2 topic

```
# Terminal 2
cd ~/ABC2025_main_controller
rosfoxy # alias
ros2 run path_generation astar_fixed_start custom
```

```
# Terminal 5
cd ~/ABC2025_main_controller
rosfoxy # alias
ros2 run path_generation publish_pcd 02142 # date number
```


# Simulation via Gazebo
A drone model of this simulation is iris_depth_camera. To change the plug-in file to synchronize with ROS2, the modified pendulum file of depth_camera is in the assest file.
TB_world1.world file for the gazebo simulation is also included in assets file. 


```
# Terminal 5: syncronize with gazebo and PX4
MicroXRCEAgent udp4 -p 8888
```

```
# Terminal 6: gazebo simulation with iris_depth_camera & TB_world1.
cd ~/PX4-Autopilot
make px4_sitl gazebo-classic_iris_depth_camera__TB_world1
```

```
# Terminal 7
cd ~/Application
./QGroundControl.AppImage
```

```
# Terminal 8: Give orders to follow the path generated by astar node.
cd ~/ABC2025_main_controller
rosfoxy # alias
ros2 run drone_controller test_03_astar_follower
```

## SLAM
The depth camera collects the depth information about surroundings or the drone, and generate the global PointCloud map with SLAM.

### RTABMAP
RTABMAP's ROS Package.
```
# install
sudo apt install ros-$ROS_DISTRO-rtabmap-ros
```

```
# Terminal 9: Rtabmap with RGB-D camera.
ros2 launch rtabmap_launch rtabmap.launch.py \
    frame_id:=depth_camera_link \
    rgb_topic:=/depth_camera/image_raw \
    depth_topic:=/depth_camera/depth/image_raw \
    camera_info_topic:=/depth_camera/camera_info \
    approx_sync:=true \
    qos:=2 \
    rviz:=truertabmap_args:="--RGBD/NoiseFilterRadius 0.05 --RGBD/NoiseFilterMinNeighbors 5"
```

## YOLO
Balloon object detection with YOLO v8
Trained model: best.pt

```
# Terminal 10: Yolo detection
ros2 run yolo_detecion yolo_detector
```
